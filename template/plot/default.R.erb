#!/usr/bin/env Rscript
###' DOS> cd %HOME%/devel-godigo/casteml/template/plot/
###' DOS> casteml download -R 20130528105235-594267 > example.pml
###' DOS> casteml plot example.pml --template-file default.R.erb 
###'
###' I/O SETUP
## infile <- "example.dataframe"
infile <- "<%= File.basename(dataframe_path,'*') -%>"

###' ----------------
###' Load dataset from csvfile
###' ----------------
## tbl0 <- read.csv(infile,header=T,stringsAsFactors=F)
tbl0 <- t(read.csv(infile,row.names=1,header=T,stringsAsFactors=F))
pdf(sprintf("%s.%s",sub("\\.[[:alnum:]]+$","",infile),"pdf"))

###' ----------------
###' Real work
###' ----------------
chemlist   <- colnames(tbl0)
stonelist  <- rownames(tbl0)
stoneindex <- 1:length(stonelist)
cexax      <- 0.2

for(iichem in 1:length(chemlist)) {
    iimean <- mean(tbl0[,iichem], na.rm = T)
    if (is.nan(iimean) == FALSE) {
        XX    <- stoneindex
        YY    <- tbl0[,iichem] / iimean
        title <- sprintf("%s / %.3g",chemlist[iichem],iimean)
        plot(XX,YY,xaxt="n",type="o",col=stoneindex,xlab="",ylab="",main=title)
        axis(1,at=stoneindex,cex.axis=cexax,las=2,labels=stonelist,cex=cexax,tck=-0.005)
    }
}

###' ----------------
###' Closing remark
###' ----------------
dev.off()
